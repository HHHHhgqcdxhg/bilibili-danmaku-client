"use strict";

require("core-js/modules/es6.object.assign");

/**
 * definitions.js describes the Definitions of Application Events.
 * For the concept of Definition, see compile.js.
 * For the concept of Application Events, see Wiki page 'Application Protocol'.
 *
 * This file does not contain much documentation because:
 * - It makes use of Tramsformer.js, compile.js and helpers.js, which are well-
 *   documented.
 * - The code of Definitions are very easy to read and understand.
 * - The details of how JSONs before transformation look like and how Events
 *   after transformation look like are documented in a separate Wiki page
 *   'Events'. That should be the first source of information, not this file.
 *
 * Therefore, the following transformers are NOT documented. My apologies.
 */
var _require = require('lodash'),
    fromPairs = _require.fromPairs;

var Transformer = require('./Transformer');

var compile = require('./compile');

var _require2 = require('./helpers'),
    asFlag = _require2.asFlag,
    onWhen = _require2.onWhen,
    on = _require2.on,
    onExist = _require2.onExist,
    spread = _require2.spread,
    spreadObj = _require2.spreadObj; // live start & end


var liveEnd = new Transformer('PREPARING', 'liveEnd', spreadObj(['roomid', parseInt, 'roomId']));
var liveStart = new Transformer('LIVE', 'liveStart', spreadObj(['roomid', parseInt, 'roomId'])); // danmaku

var danmaku = new Transformer('DANMU_MSG', 'danmaku', on(function (m) {
  return m.info;
}, {
  timestamp: function timestamp(i) {
    return i[0][3];
  },
  content: function content(i) {
    return i[1];
  },
  sender: on(function (i) {
    return i[2];
  }, spread('uid', 'name', ['isOwner', asFlag], ['isVip', asFlag], ['isSvip', asFlag])),
  badge: onExist(function (i) {
    return i[3];
  }, spread('level', 'name', 'owner', 'roomId')),
  ul: on(function (i) {
    return i[4];
  }, {
    ranking: function ranking(u) {
      return u[3];
    },
    level: function level(u) {
      return u[0];
    }
  }),
  medal: onExist(function (i) {
    return i[5];
  }, spread('first', 'second'))
})); // gift

var userSrc = spreadObj('face', 'uid', 'guard_level', ['uname', 0, 'name']);
var parseTopUser = compile(Object.assign({}, userSrc, spreadObj('rank', ['score', 0, 'spentCoins'], ['isSelf', asFlag])));
var gift = new Transformer('SEND_GIFT', 'gift', on(function (m) {
  return m.data;
}, Object.assign({}, spreadObj('num', 'remain', 'action', 'timestamp', 'coin_type', 'total_coin', 'super_gift_num', 'effect_block'), {
  gift: spreadObj(['giftName', 0, 'name'], ['giftId', 0, 'id'], ['giftType', 0, 'type'], 'price'),
  sender: userSrc,
  left: onWhen(function (m) {
    return m;
  }, function (m) {
    return m.gold > 0 && m.silver > 0;
  }, spreadObj('gold', 'silver')),
  topList: function topList(d) {
    return d.top_list.map(parseTopUser);
  }
})));
var tempoStorm = new Transformer('SPECIAL_GIFT', 'tempoStorm', on(function (m) {
  return m.data[39];
}, Object.assign({}, spreadObj('action', 'id'), {
  storm: onWhen(function (d) {
    return d;
  }, function (d) {
    return d.action === 'start';
  }, spreadObj('content', 'time', 'storm_gif', ['hadJoin', 0, 'joined'], 'num'))
})));
var comboEnd = new Transformer('COMBO_END', 'comboEnd', on(function (m) {
  return m.data;
}, spreadObj('price', 'gift_id', 'gift_name', 'combo_num', 'price', 'gift_id', 'start_time', 'end_time', ['uname', 0, 'name'], ['r_uname', 0, 'owner']))); // broadcast message

var guardMsg = new Transformer('GUARD_MSG', 'guardMsg', spreadObj('msg', ['buy_type', 0, 'guardLevel']));
var sysMsg = new Transformer('SYS_MSG', 'sysMsg', spreadObj('msg', 'rep', 'styleType', 'url', 'msg_text', ['real_roomid', 0, 'realRoomId'], ['roomid', 0, 'roomId'])); // welcome

var welcomeVip = new Transformer('WELCOME', 'welcomeVip', on(function (m) {
  return m.data;
}, Object.assign({}, spreadObj('uid', ['uname', 0, 'name'], ['is_admin', asFlag]), {
  isVip: function isVip(d) {
    return 'vip' in d && d.vip === 1 || 'svip' in d && d.svip === 1;
  },
  isSvip: function isSvip(d) {
    return 'svip' in d && d.svip === 1;
  }
})));
var welcomeGuard = new Transformer('WELCOME_GUARD', 'welcomeGuard', on(function (m) {
  return m.data;
}, spreadObj('uid', 'guard_level', ['username', 0, 'name']))); // events

var wishBottle = new Transformer('WISH_BOTTLE', 'wishBottle', on(function (m) {
  return m.data;
}, Object.assign({}, spreadObj('action', 'id'), {
  wish: on(function (m) {
    return m.wish;
  }, spreadObj('content', 'status', 'type', 'type_id', 'uid', 'wish_limit', 'wish_progress', 'count_map', ['ctime', function (str) {
    return new Date(str).getTime();
  }, 'timestamp'], ['uid', 0, 'anchor']))
})));
var roomRank = new Transformer('ROOM_RANK', 'roomRank', on(function (m) {
  return m.data;
}, spreadObj('timestamp', 'color', 'h5_url', 'web_url', ['roomid', 0, 'roomId'], ['rank_desc', 0, 'rank'])));
var guardBuy = new Transformer('GUARD_BUY', 'guardBuy', Object.assign({}, on(function (m) {
  return m.data;
}, Object.assign({}, spreadObj('guard_level', 'num'), {
  buyer: spreadObj(['username', undefined, function () {
    return 'name';
  }], 'uid')
})), spreadObj(['roomid', parseInt, function () {
  return 'roomId';
}]))); // blocking

var blockUser = new Transformer('ROOM_BLOCK_MSG', 'blockUser', {
  roomId: function roomId(m) {
    return m.roomid;
  },
  blocked: spreadObj(['uid', parseInt], ['uname', 0, 'name'])
});
var silentOn = new Transformer('ROOM_SILENT_ON', 'silentOn', Object.assign({
  roomId: function roomId(m) {
    return m.roomid;
  }
}, on(function (m) {
  return m.data;
}, Object.assign({}, spreadObj('type', 'second'), onWhen(function (d) {
  return d;
}, function (d) {
  return d.type === 'level';
}, spreadObj('level'))))));
var silentOff = new Transformer('ROOM_SILENT_OFF', 'silentOff', spreadObj(['roomid', parseInt, 'roomId']));
var transformers = [liveStart, liveEnd, danmaku, gift, tempoStorm, comboEnd, guardMsg, sysMsg, welcomeVip, welcomeGuard, wishBottle, roomRank, guardBuy, blockUser, silentOn, silentOff];
var registry = fromPairs(transformers.map(function (t) {
  return [t.cmd, t];
}));
module.exports = {
  transformers: transformers,
  registry: registry
};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9hcHBsaWNhdGlvbi9kZWZpbml0aW9ucy5qcyJdLCJuYW1lcyI6WyJyZXF1aXJlIiwiZnJvbVBhaXJzIiwiVHJhbnNmb3JtZXIiLCJjb21waWxlIiwiYXNGbGFnIiwib25XaGVuIiwib24iLCJvbkV4aXN0Iiwic3ByZWFkIiwic3ByZWFkT2JqIiwibGl2ZUVuZCIsInBhcnNlSW50IiwibGl2ZVN0YXJ0IiwiZGFubWFrdSIsIm0iLCJpbmZvIiwidGltZXN0YW1wIiwiaSIsImNvbnRlbnQiLCJzZW5kZXIiLCJiYWRnZSIsInVsIiwicmFua2luZyIsInUiLCJsZXZlbCIsIm1lZGFsIiwidXNlclNyYyIsInBhcnNlVG9wVXNlciIsImdpZnQiLCJkYXRhIiwibGVmdCIsImdvbGQiLCJzaWx2ZXIiLCJ0b3BMaXN0IiwiZCIsInRvcF9saXN0IiwibWFwIiwidGVtcG9TdG9ybSIsInN0b3JtIiwiYWN0aW9uIiwiY29tYm9FbmQiLCJndWFyZE1zZyIsInN5c01zZyIsIndlbGNvbWVWaXAiLCJpc1ZpcCIsInZpcCIsInN2aXAiLCJpc1N2aXAiLCJ3ZWxjb21lR3VhcmQiLCJ3aXNoQm90dGxlIiwid2lzaCIsIkRhdGUiLCJzdHIiLCJnZXRUaW1lIiwicm9vbVJhbmsiLCJndWFyZEJ1eSIsImJ1eWVyIiwidW5kZWZpbmVkIiwiYmxvY2tVc2VyIiwicm9vbUlkIiwicm9vbWlkIiwiYmxvY2tlZCIsInNpbGVudE9uIiwidHlwZSIsInNpbGVudE9mZiIsInRyYW5zZm9ybWVycyIsInJlZ2lzdHJ5IiwidCIsImNtZCIsIm1vZHVsZSIsImV4cG9ydHMiXSwibWFwcGluZ3MiOiI7Ozs7QUFBQTs7Ozs7Ozs7Ozs7Ozs7O2VBZ0JzQkEsUUFBUSxRQUFSLEM7SUFBZEMsUyxZQUFBQSxTOztBQUVSLElBQU1DLGNBQWNGLFFBQVEsZUFBUixDQUFwQjs7QUFDQSxJQUFNRyxVQUFVSCxRQUFRLFdBQVIsQ0FBaEI7O2dCQUMyREEsUUFBUSxXQUFSLEM7SUFBbkRJLE0sYUFB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QyxVQVRpQixFQVVqQkssWUFWaUIsRUFXakJDLFVBWGlCLEVBWWpCSyxRQVppQixFQWFqQkMsUUFiaUIsRUFjakJHLFNBZGlCLEVBZWpCSSxRQWZpQixFQWdCakJFLFNBaEJpQixDQUFyQjtBQWtCQSxJQUFNRSxXQUFXakUsVUFBVWdFLGFBQWE3QixHQUFiLENBQWlCO0FBQUEsU0FBSyxDQUFDK0IsRUFBRUMsR0FBSCxFQUFRRCxDQUFSLENBQUw7QUFBQSxDQUFqQixDQUFWLENBQWpCO0FBRUFFLE9BQU9DLE9BQVAsR0FBaUI7QUFBRUwsNEJBQUY7QUFBZ0JDO0FBQWhCLENBQWpCIiwic291cmNlc0NvbnRlbnQiOlsiLyoqXHJcbiAqIGRlZmluaXRpb25zLmpzIGRlc2NyaWJlcyB0aGUgRGVmaW5pdGlvbnMgb2YgQXBwbGljYXRpb24gRXZlbnRzLlxyXG4gKiBGb3IgdGhlIGNvbmNlcHQgb2YgRGVmaW5pdGlvbiwgc2VlIGNvbXBpbGUuanMuXHJcbiAqIEZvciB0aGUgY29uY2VwdCBvZiBBcHBsaWNhdGlvbiBFdmVudHMsIHNlZSBXaWtpIHBhZ2UgJ0FwcGxpY2F0aW9uIFByb3RvY29sJy5cclxuICpcclxuICogVGhpcyBmaWxlIGRvZXMgbm90IGNvbnRhaW4gbXVjaCBkb2N1bWVudGF0aW9uIGJlY2F1c2U6XHJcbiAqIC0gSXQgbWFrZXMgdXNlIG9mIFRyYW1zZm9ybWVyLmpzLCBjb21waWxlLmpzIGFuZCBoZWxwZXJzLmpzLCB3aGljaCBhcmUgd2VsbC1cclxuICogICBkb2N1bWVudGVkLlxyXG4gKiAtIFRoZSBjb2RlIG9mIERlZmluaXRpb25zIGFyZSB2ZXJ5IGVhc3kgdG8gcmVhZCBhbmQgdW5kZXJzdGFuZC5cclxuICogLSBUaGUgZGV0YWlscyBvZiBob3cgSlNPTnMgYmVmb3JlIHRyYW5zZm9ybWF0aW9uIGxvb2sgbGlrZSBhbmQgaG93IEV2ZW50c1xyXG4gKiAgIGFmdGVyIHRyYW5zZm9ybWF0aW9uIGxvb2sgbGlrZSBhcmUgZG9jdW1lbnRlZCBpbiBhIHNlcGFyYXRlIFdpa2kgcGFnZVxyXG4gKiAgICdFdmVudHMnLiBUaGF0IHNob3VsZCBiZSB0aGUgZmlyc3Qgc291cmNlIG9mIGluZm9ybWF0aW9uLCBub3QgdGhpcyBmaWxlLlxyXG4gKlxyXG4gKiBUaGVyZWZvcmUsIHRoZSBmb2xsb3dpbmcgdHJhbnNmb3JtZXJzIGFyZSBOT1QgZG9jdW1lbnRlZC4gTXkgYXBvbG9naWVzLlxyXG4gKi9cclxuXHJcbmNvbnN0IHsgZnJvbVBhaXJzIH0gPSByZXF1aXJlKCdsb2Rhc2gnKTtcclxuXHJcbmNvbnN0IFRyYW5zZm9ybWVyID0gcmVxdWlyZSgnLi9UcmFuc2Zvcm1lcicpO1xyXG5jb25zdCBjb21waWxlID0gcmVxdWlyZSgnLi9jb21waWxlJyk7XHJcbmNvbnN0IHsgYXNGbGFnLCBvbldoZW4sIG9uLCBvbkV4aXN0LCBzcHJlYWQsIHNwcmVhZE9iaiB9ID0gcmVxdWlyZSgnLi9oZWxwZXJzJyk7XHJcblxyXG4vLyBsaXZlIHN0YXJ0ICYgZW5kXHJcbmNvbnN0IGxpdmVFbmQgPSBuZXcgVHJhbnNmb3JtZXIoJ1BSRVBBUklORycsICdsaXZlRW5kJywgc3ByZWFkT2JqKFsncm9vbWlkJywgcGFyc2VJbnQsICdyb29tSWQnXSkpO1xyXG5jb25zdCBsaXZlU3RhcnQgPSBuZXcgVHJhbnNmb3JtZXIoJ0xJVkUnLCAnbGl2ZVN0YXJ0Jywgc3ByZWFkT2JqKFsncm9vbWlkJywgcGFyc2VJbnQsICdyb29tSWQnXSkpO1xyXG5cclxuLy8gZGFubWFrdVxyXG5jb25zdCBkYW5tYWt1ID0gbmV3IFRyYW5zZm9ybWVyKCdEQU5NVV9NU0cnLCAnZGFubWFrdScsIG9uKG0gPT4gbS5pbmZvLCB7XHJcbiAgICB0aW1lc3RhbXA6IGkgPT4gaVswXVszXSxcclxuICAgIGNvbnRlbnQ6IGkgPT4gaVsxXSxcclxuICAgIHNlbmRlcjogb24oaSA9PiBpWzJdLCBzcHJlYWQoJ3VpZCcsICduYW1lJywgWydpc093bmVyJywgYXNGbGFnXSwgWydpc1ZpcCcsIGFzRmxhZ10sIFsnaXNTdmlwJywgYXNGbGFnXSkpLFxyXG4gICAgYmFkZ2U6IG9uRXhpc3QoaSA9PiBpWzNdLCBzcHJlYWQoJ2xldmVsJywgJ25hbWUnLCAnb3duZXInLCAncm9vbUlkJykpLFxyXG4gICAgdWw6IG9uKGkgPT4gaVs0XSwge1xyXG4gICAgICAgIHJhbmtpbmc6IHUgPT4gdVszXSxcclxuICAgICAgICBsZXZlbDogdSA9PiB1WzBdLFxyXG4gICAgfSksXHJcbiAgICBtZWRhbDogb25FeGlzdChpID0+IGlbNV0sIHNwcmVhZCgnZmlyc3QnLCAnc2Vjb25kJykpLFxyXG59KSk7XHJcblxyXG4vLyBnaWZ0XHJcbmNvbnN0IHVzZXJTcmMgPSBzcHJlYWRPYmooJ2ZhY2UnLCAndWlkJywgJ2d1YXJkX2xldmVsJywgWyd1bmFtZScsIDAsICduYW1lJ10pO1xyXG5jb25zdCBwYXJzZVRvcFVzZXIgPSBjb21waWxlKHtcclxuICAgIC4uLnVzZXJTcmMsIC4uLnNwcmVhZE9iaigncmFuaycsIFsnc2NvcmUnLCAwLCAnc3BlbnRDb2lucyddLCBbJ2lzU2VsZicsIGFzRmxhZ10pLFxyXG59KTtcclxuY29uc3QgZ2lmdCA9IG5ldyBUcmFuc2Zvcm1lcignU0VORF9HSUZUJywgJ2dpZnQnLCBvbihtID0+IG0uZGF0YSwge1xyXG4gICAgLi4uc3ByZWFkT2JqKFxyXG4gICAgICAgICdudW0nLCAncmVtYWluJywgJ2FjdGlvbicsICd0aW1lc3RhbXAnLCAnY29pbl90eXBlJywgJ3RvdGFsX2NvaW4nLCAnc3VwZXJfZ2lmdF9udW0nLCAnZWZmZWN0X2Jsb2NrJyxcclxuICAgICksXHJcbiAgICBnaWZ0OiBzcHJlYWRPYmooWydnaWZ0TmFtZScsIDAsICduYW1lJ10sIFsnZ2lmdElkJywgMCwgJ2lkJ10sIFsnZ2lmdFR5cGUnLCAwLCAndHlwZSddLCAncHJpY2UnKSxcclxuICAgIHNlbmRlcjogdXNlclNyYyxcclxuICAgIGxlZnQ6IG9uV2hlbihtID0+IG0sIG0gPT4gbS5nb2xkID4gMCAmJiBtLnNpbHZlciA+IDAsIHNwcmVhZE9iaignZ29sZCcsICdzaWx2ZXInKSksXHJcbiAgICB0b3BMaXN0OiBkID0+IGQudG9wX2xpc3QubWFwKHBhcnNlVG9wVXNlciksXHJcbn0pKTtcclxuY29uc3QgdGVtcG9TdG9ybSA9IG5ldyBUcmFuc2Zvcm1lcignU1BFQ0lBTF9HSUZUJywgJ3RlbXBvU3Rvcm0nLCBvbihtID0+IG0uZGF0YVszOV0sIHtcclxuICAgIC4uLnNwcmVhZE9iaignYWN0aW9uJywgJ2lkJyksXHJcbiAgICBzdG9ybTogb25XaGVuKGQgPT4gZCwgZCA9PiBkLmFjdGlvbiA9PT0gJ3N0YXJ0Jywgc3ByZWFkT2JqKFxyXG4gICAgICAgICdjb250ZW50JywgJ3RpbWUnLCAnc3Rvcm1fZ2lmJywgWydoYWRKb2luJywgMCwgJ2pvaW5lZCddLCAnbnVtJyxcclxuICAgICkpLFxyXG59KSk7XHJcbmNvbnN0IGNvbWJvRW5kID0gbmV3IFRyYW5zZm9ybWVyKCdDT01CT19FTkQnLCAnY29tYm9FbmQnLCBvbihtID0+IG0uZGF0YSwgc3ByZWFkT2JqKFxyXG4gICAgJ3ByaWNlJywgJ2dpZnRfaWQnLCAnZ2lmdF9uYW1lJywgJ2NvbWJvX251bScsICdwcmljZScsICdnaWZ0X2lkJywgJ3N0YXJ0X3RpbWUnLCAnZW5kX3RpbWUnLFxyXG4gICAgWyd1bmFtZScsIDAsICduYW1lJ10sIFsncl91bmFtZScsIDAsICdvd25lciddLFxyXG4pKSk7XHJcblxyXG4vLyBicm9hZGNhc3QgbWVzc2FnZVxyXG5jb25zdCBndWFyZE1zZyA9IG5ldyBUcmFuc2Zvcm1lcignR1VBUkRfTVNHJywgJ2d1YXJkTXNnJywgc3ByZWFkT2JqKCdtc2cnLCBbJ2J1eV90eXBlJywgMCwgJ2d1YXJkTGV2ZWwnXSkpO1xyXG5jb25zdCBzeXNNc2cgPSBuZXcgVHJhbnNmb3JtZXIoJ1NZU19NU0cnLCAnc3lzTXNnJywgc3ByZWFkT2JqKFxyXG4gICAgJ21zZycsICdyZXAnLCAnc3R5bGVUeXBlJywgJ3VybCcsICdtc2dfdGV4dCcsXHJcbiAgICBbJ3JlYWxfcm9vbWlkJywgMCwgJ3JlYWxSb29tSWQnXSwgWydyb29taWQnLCAwLCAncm9vbUlkJ10sXHJcbikpO1xyXG5cclxuLy8gd2VsY29tZVxyXG5jb25zdCB3ZWxjb21lVmlwID0gbmV3IFRyYW5zZm9ybWVyKCdXRUxDT01FJywgJ3dlbGNvbWVWaXAnLCBvbihtID0+IG0uZGF0YSwge1xyXG4gICAgLi4uc3ByZWFkT2JqKCd1aWQnLCBbJ3VuYW1lJywgMCwgJ25hbWUnXSwgWydpc19hZG1pbicsIGFzRmxhZ10pLFxyXG4gICAgaXNWaXA6IGQgPT4gKCd2aXAnIGluIGQgJiYgZC52aXAgPT09IDEpIHx8ICgnc3ZpcCcgaW4gZCAmJiBkLnN2aXAgPT09IDEpLFxyXG4gICAgaXNTdmlwOiBkID0+ICgnc3ZpcCcgaW4gZCAmJiBkLnN2aXAgPT09IDEpLFxyXG59KSk7XHJcbmNvbnN0IHdlbGNvbWVHdWFyZCA9IG5ldyBUcmFuc2Zvcm1lcignV0VMQ09NRV9HVUFSRCcsICd3ZWxjb21lR3VhcmQnLCBvbihtID0+IG0uZGF0YSwgc3ByZWFkT2JqKFxyXG4gICAgJ3VpZCcsICdndWFyZF9sZXZlbCcsIFsndXNlcm5hbWUnLCAwLCAnbmFtZSddLFxyXG4pKSk7XHJcblxyXG4vLyBldmVudHNcclxuY29uc3Qgd2lzaEJvdHRsZSA9IG5ldyBUcmFuc2Zvcm1lcignV0lTSF9CT1RUTEUnLCAnd2lzaEJvdHRsZScsIG9uKG0gPT4gbS5kYXRhLCB7XHJcbiAgICAuLi5zcHJlYWRPYmooJ2FjdGlvbicsICdpZCcpLFxyXG4gICAgd2lzaDogb24obSA9PiBtLndpc2gsIHNwcmVhZE9iaihcclxuICAgICAgICAnY29udGVudCcsICdzdGF0dXMnLCAndHlwZScsICd0eXBlX2lkJywgJ3VpZCcsICd3aXNoX2xpbWl0JywgJ3dpc2hfcHJvZ3Jlc3MnLCAnY291bnRfbWFwJyxcclxuICAgICAgICBbJ2N0aW1lJywgc3RyID0+IG5ldyBEYXRlKHN0cikuZ2V0VGltZSgpLCAndGltZXN0YW1wJ10sIFsndWlkJywgMCwgJ2FuY2hvciddLFxyXG4gICAgKSksXHJcbn0pKTtcclxuY29uc3Qgcm9vbVJhbmsgPSBuZXcgVHJhbnNmb3JtZXIoJ1JPT01fUkFOSycsICdyb29tUmFuaycsIG9uKG0gPT4gbS5kYXRhLCBzcHJlYWRPYmooXHJcbiAgICAndGltZXN0YW1wJywgJ2NvbG9yJywgJ2g1X3VybCcsICd3ZWJfdXJsJywgWydyb29taWQnLCAwLCAncm9vbUlkJ10sIFsncmFua19kZXNjJywgMCwgJ3JhbmsnXSxcclxuKSkpO1xyXG5jb25zdCBndWFyZEJ1eSA9IG5ldyBUcmFuc2Zvcm1lcignR1VBUkRfQlVZJywgJ2d1YXJkQnV5Jywge1xyXG4gICAgLi4ub24obSA9PiBtLmRhdGEsIHtcclxuICAgICAgICAuLi5zcHJlYWRPYmooJ2d1YXJkX2xldmVsJywgJ251bScpLFxyXG4gICAgICAgIGJ1eWVyOiBzcHJlYWRPYmooWyd1c2VybmFtZScsIHVuZGVmaW5lZCwgKCkgPT4gJ25hbWUnXSwgJ3VpZCcpLFxyXG4gICAgfSksXHJcbiAgICAuLi5zcHJlYWRPYmooWydyb29taWQnLCBwYXJzZUludCwgKCkgPT4gJ3Jvb21JZCddKSxcclxufSk7XHJcblxyXG4vLyBibG9ja2luZ1xyXG5jb25zdCBibG9ja1VzZXIgPSBuZXcgVHJhbnNmb3JtZXIoJ1JPT01fQkxPQ0tfTVNHJywgJ2Jsb2NrVXNlcicsIHtcclxuICAgIHJvb21JZDogbSA9PiBtLnJvb21pZCwgYmxvY2tlZDogc3ByZWFkT2JqKFsndWlkJywgcGFyc2VJbnRdLCBbJ3VuYW1lJywgMCwgJ25hbWUnXSksXHJcbn0pO1xyXG5jb25zdCBzaWxlbnRPbiA9IG5ldyBUcmFuc2Zvcm1lcignUk9PTV9TSUxFTlRfT04nLCAnc2lsZW50T24nLCB7XHJcbiAgICByb29tSWQ6IG0gPT4gbS5yb29taWQsXHJcbiAgICAuLi5vbihtID0+IG0uZGF0YSwge1xyXG4gICAgICAgIC4uLnNwcmVhZE9iaigndHlwZScsICdzZWNvbmQnKSxcclxuICAgICAgICAuLi5vbldoZW4oZCA9PiBkLCBkID0+IGQudHlwZSA9PT0gJ2xldmVsJywgc3ByZWFkT2JqKCdsZXZlbCcpKSxcclxuICAgIH0pLFxyXG59KTtcclxuY29uc3Qgc2lsZW50T2ZmID0gbmV3IFRyYW5zZm9ybWVyKCdST09NX1NJTEVOVF9PRkYnLCAnc2lsZW50T2ZmJywgc3ByZWFkT2JqKFsncm9vbWlkJywgcGFyc2VJbnQsICdyb29tSWQnXSkpO1xyXG5cclxuY29uc3QgdHJhbnNmb3JtZXJzID0gW1xyXG4gICAgbGl2ZVN0YXJ0LFxyXG4gICAgbGl2ZUVuZCxcclxuICAgIGRhbm1ha3UsXHJcbiAgICBnaWZ0LFxyXG4gICAgdGVtcG9TdG9ybSxcclxuICAgIGNvbWJvRW5kLFxyXG4gICAgZ3VhcmRNc2csXHJcbiAgICBzeXNNc2csXHJcbiAgICB3ZWxjb21lVmlwLFxyXG4gICAgd2VsY29tZUd1YXJkLFxyXG4gICAgd2lzaEJvdHRsZSxcclxuICAgIHJvb21SYW5rLFxyXG4gICAgZ3VhcmRCdXksXHJcbiAgICBibG9ja1VzZXIsXHJcbiAgICBzaWxlbnRPbixcclxuICAgIHNpbGVudE9mZixcclxuXTtcclxuY29uc3QgcmVnaXN0cnkgPSBmcm9tUGFpcnModHJhbnNmb3JtZXJzLm1hcCh0ID0+IFt0LmNtZCwgdF0pKTtcclxuXHJcbm1vZHVsZS5leHBvcnRzID0geyB0cmFuc2Zvcm1lcnMsIHJlZ2lzdHJ5IH07XHJcbiJdfQ==
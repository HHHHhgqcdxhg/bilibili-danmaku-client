{"version":3,"sources":["../../src/transformers/definitions.js"],"names":["Transformer","require","compile","asFlag","onWhen","on","onExist","spread","spreadObj","liveEnd","parseInt","liveStart","danmaku","m","info","timestamp","i","content","sender","badge","ul","ranking","u","level","medal","userSrc","undefined","parseTopUser","gift","data","left","gold","silver","topList","d","top_list","map","tempoStorm","storm","action","comboEnd","guardMsg","sysMsg","welcomeVip","isVip","vip","svip","isSvip","welcomeGuard","wishBottle","wish","Date","str","getTime","roomRank","guardBuy","buyer","blockUser","roomId","roomid","blocked","silentOn","type","silentOff","module","exports"],"mappings":"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","sourcesContent":["const Transformer = require('./Transformer');\r\nconst { compile, asFlag, onWhen, on, onExist, spread, spreadObj } = require('./compile');\r\n\r\n// live start & end\r\nconst liveEnd = new Transformer('PREPARING', 'liveEnd',\r\n    spreadObj(['roomid', parseInt, () => 'roomId']));\r\nconst liveStart = new Transformer('LIVE', 'liveStart',\r\n    spreadObj(['roomid', parseInt, () => 'roomId']));\r\n\r\n// danmaku\r\nconst danmaku = new Transformer('DANMU_MSG', 'danmaku', on(m => m.info, {\r\n    timestamp: i => i[0][4],\r\n    content: i => i[1],\r\n    sender: on(i => i[2], spread('uid', 'name', ['isOwner', asFlag], ['isVip', asFlag], ['isSvip', asFlag])),\r\n    badge: onExist(i => i[3], spread('level', 'name', 'owner', 'roomId')),\r\n    ul: on(i => i[4], {\r\n        ranking: u => u[3],\r\n        level: u => u[0],\r\n    }),\r\n    medal: onExist(i => i[5], spread('first', 'second')),\r\n}));\r\n\r\n// gift\r\nconst userSrc = spreadObj(\r\n    'face', 'uid', 'guard_level',\r\n    ['uname', undefined, () => 'name'],\r\n);\r\nconst parseTopUser = compile({\r\n    ...userSrc, ...spreadObj('rank', 'score', ['isSelf', asFlag]),\r\n});\r\nconst gift = new Transformer('SEND_GIFT', 'gift', on(m => m.data, {\r\n    ...spreadObj(\r\n        'giftName', 'giftId', 'giftType', 'num', 'remain', 'price', 'action', 'timestamp',\r\n        'coin_type', 'total_coin', 'super_gift_num', 'effect_block',\r\n    ),\r\n    sender: userSrc,\r\n    left: onWhen(m => m, m => m.gold > 0 && m.silver > 0, spreadObj('gold', 'silver')),\r\n    topList: d => d.top_list.map(parseTopUser),\r\n}));\r\nconst tempoStorm = new Transformer('SPECIAL_GIFT', 'tempoStorm', on(m => m.data[39], {\r\n    ...spreadObj('action', 'id'),\r\n    storm: onWhen(d => d, d => d.action === 'start', spreadObj(\r\n        'content', 'time', 'storm_gif', ['hadJoin', undefined, () => 'joined'], 'num',\r\n    )),\r\n}));\r\nconst comboEnd = new Transformer('COMBO_END', 'comboEnd', on(m => m.data, spreadObj(\r\n    'price', 'gift_id', 'gift_name', 'combo_num', 'price', 'gift_id', 'start_time', 'end_time',\r\n    ['uname', undefined, () => 'name'], // sender name\r\n    ['r_uname', undefined, () => 'owner'], // name of room owner\r\n)));\r\n\r\n// broadcast message\r\nconst guardMsg = new Transformer('GUARD_MSG', 'guardMsg',\r\n    spreadObj('msg', ['buy_type', undefined, () => 'guardLevel']));\r\nconst sysMsg = new Transformer('SYS_MSG', 'sysMsg', spreadObj(\r\n    'msg', 'rep', 'styleType', 'url', 'msg_text',\r\n    ['real_roomid', undefined, () => 'realRoomId'],\r\n    ['roomid', undefined, () => 'roomId'],\r\n));\r\n\r\n// welcome\r\nconst welcomeVip = new Transformer('WELCOME', 'welcomeVip', on(m => m.data, {\r\n    ...spreadObj('uid', ['uname', undefined, () => 'name'], ['is_admin', asFlag]),\r\n    isVip: d => ('vip' in d && d.vip === 1) || ('svip' in d && d.svip === 1),\r\n    isSvip: d => ('svip' in d && d.svip === 1),\r\n}));\r\nconst welcomeGuard = new Transformer('WELCOME_GUARD', 'welcomeGuard', on(m => m.data, spreadObj(\r\n    'uid', 'guard_level', ['username', undefined, () => 'name'],\r\n)));\r\n\r\n// events\r\nconst wishBottle = new Transformer('WISH_BOTTLE', 'wishBottle', on(m => m.data, {\r\n    ...spreadObj('action', 'id'),\r\n    wish: on(m => m.wish, spreadObj(\r\n        'content', 'status', 'type', 'type_id', 'uid', 'wish_limit', 'wish_progress', 'count_map',\r\n        ['ctime', str => new Date(str).getTime(), () => 'timestamp'],\r\n        ['uid', undefined, () => 'anchor'],\r\n    )),\r\n}));\r\nconst roomRank = new Transformer('ROOM_RANK', 'roomRank', on(m => m.data, spreadObj(\r\n    'timestamp', 'color', 'h5_url', 'web_url',\r\n    ['roomid', undefined, () => 'roomId'],\r\n    ['rank_desc', undefined, () => 'rank'],\r\n)));\r\nconst guardBuy = new Transformer('GUARD_BUY', 'guardBuy', {\r\n    ...on(m => m.data, {\r\n        ...spreadObj('guard_level', 'num'),\r\n        buyer: spreadObj(['username', undefined, () => 'name'], 'uid'),\r\n    }),\r\n    ...spreadObj(['roomid', parseInt, () => 'roomId']),\r\n});\r\n\r\n// blocking\r\nconst blockUser = new Transformer('ROOM_BLOCK_MSG', 'blockUser', {\r\n    roomId: m => m.roomid,\r\n    blocked: spreadObj(['uid', parseInt], ['uname', null, () => 'name']),\r\n});\r\nconst silentOn = new Transformer('ROOM_SILENT_ON', 'silentOn', {\r\n    roomId: m => m.roomid,\r\n    ...on(m => m.data, {\r\n        ...spreadObj('type', 'second'),\r\n        ...onWhen(d => d, d => d.type === 'level', spreadObj('level')),\r\n    }),\r\n});\r\nconst silentOff = new Transformer('ROOM_SILENT_OFF', 'silentOff',\r\n    spreadObj(['roomid', parseInt, () => 'roomId`']));\r\n\r\nmodule.exports = [\r\n    liveStart,\r\n    liveEnd,\r\n    danmaku,\r\n    gift,\r\n    tempoStorm,\r\n    comboEnd,\r\n    guardMsg,\r\n    sysMsg,\r\n    welcomeVip,\r\n    welcomeGuard,\r\n    wishBottle,\r\n    roomRank,\r\n    guardBuy,\r\n    blockUser,\r\n    silentOn,\r\n    silentOff,\r\n];\r\n"],"file":"definitions.js"}